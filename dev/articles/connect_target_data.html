<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Accessing Target Data • hubData</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Accessing Target Data">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://hubdocs.readthedocs.io/en/latest/" class="external-link"><img src="https://raw.githubusercontent.com/hubverse-org/hubStyle/main/inst/hubverse.png" id="logo" height="30" alt="hubverse"></a>
    <a class="navbar-brand me-2" href="../index.html">hubData</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/connect_hub.html">Accessing Model Output Data</a></li>
    <li><a class="dropdown-item" href="../articles/connect_target_data.html">Accessing Target Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hubverse-org/hubData/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Accessing Target Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hubverse-org/hubData/blob/main/vignettes/articles/connect_target_data.Rmd" class="external-link"><code>vignettes/articles/connect_target_data.Rmd</code></a></small>
      <div class="d-none name"><code>connect_target_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Target data represents the “ground truth” observations that models
are trying to predict in forecasting hubs. Understanding how to access
and work with target data is essential for evaluating model performance,
creating visualizations, and conducting analyses.</p>
<p>For a comprehensive overview of what target data is and why it
matters in the context of modeling hubs, please refer to the <a href="https://docs.hubverse.io/en/latest/user-guide/target-data.html" class="external-link">Hubverse
target data guide</a>.</p>
<p>This vignette focuses on the practical aspects of accessing target
data using hubData’s specialized functions:</p>
<ul>
<li>
<strong>Time-series target data</strong>: Historical observations
(stored as <code>target-data/time-series.csv</code>,
<code>target-data/time-series.parquet</code>, or in a
<code>target-data/time-series/</code> directory)</li>
<li>
<strong>Oracle-output target data</strong>: Model-formatted target
observations (stored as <code>target-data/oracle-output.csv</code>,
<code>target-data/oracle-output.parquet</code>, or in a
<code>target-data/oracle-output/</code> directory)</li>
</ul>
</div>
<div class="section level2">
<h2 id="target-data-structure">Target data structure<a class="anchor" aria-label="anchor" href="#target-data-structure"></a>
</h2>
<p>Modeling hubs store target data in two complementary formats, each
serving distinct purposes in the forecasting workflow:</p>
<div class="section level3">
<h3 id="time-series-format">Time-series format<a class="anchor" aria-label="anchor" href="#time-series-format"></a>
</h3>
<p>Time-series target data represents the <strong>observed counts or
rates</strong> in their native format. Each row constitutes an
<strong>observable unit</strong> - a unique combination of task ID
variables that defines a single observation. This format typically
includes:</p>
<ul>
<li>A date variable</li>
<li>Location identifiers</li>
<li>An <code>observation</code> column containing the measured value
(e.g., case counts, hospitalization numbers)</li>
<li>Other task ID variables</li>
</ul>
<p>For example, if your task IDs are location and date, then each
observable unit is a specific location-date combination (e.g., “US on
2022-10-15”), and the <code>observation</code> column contains the value
measured for that unit.</p>
<p><strong>Why time-series format?</strong> This format is designed
for:</p>
<ul>
<li>
<strong>Model fitting</strong>: Providing historical data for
parameter estimation and model training</li>
<li>
<strong>Visualization</strong>: Supporting tools like hubVis and
dashboards that display historical trends</li>
<li>
<strong>General analysis</strong>: Working with target data in its
natural, observational form</li>
</ul>
</div>
<div class="section level3">
<h3 id="oracle-output-format">Oracle-output format<a class="anchor" aria-label="anchor" href="#oracle-output-format"></a>
</h3>
<p>Oracle-output target data are generally <strong>derived from
time-series data</strong> but formatted to match the structure of model
outputs (similar to <code>model_out_tbl</code> objects). It represents
“what predictions would look like if the target values had been known
ahead of time.” Like time-series data, each row represents an
<strong>observable unit</strong> defined by the task ID variables, but
the data is structured as model output. This format includes:</p>
<ul>
<li>
<code>output_type</code> and <code>output_type_id</code>: Only
required if the hub collects <code>pmf</code> or <code>cdf</code> output
types. For <code>mean</code>, <code>median</code>,
<code>quantile</code>, and <code>sample</code> output types, these
columns can be omitted entirely.</li>
<li>
<code>oracle_value</code>: the target observation value formatted as
an “oracle” prediction</li>
<li>Task ID variables (e.g., location, date)</li>
</ul>
<p><strong>Why oracle-output format?</strong> This format is designed
for:</p>
<ul>
<li>
<strong>Model evaluation</strong>: Enabling evaluation tools like
hubEvals to directly compare model predictions against observed
outcomes</li>
<li>
<strong>Visualization</strong>: Supporting plots that display
predictions alongside target data in a consistent format (e.g., plotting
pmf predictions with categorical target data)</li>
</ul>
<p>By formatting target data as model output with all probability mass
on the observed outcome, oracle-output data allows evaluation tools to
treat it identically to model predictions.</p>
</div>
</div>
<div class="section level2">
<h2 id="connection-approach">Connection approach<a class="anchor" aria-label="anchor" href="#connection-approach"></a>
</h2>
<p>Accessing target data follows the same approach as accessing model
outputs (see <code>vignette("connect_hub")</code> for more details):</p>
<ul>
<li>Connections are established through the <a href="https://arrow.apache.org/docs/r/" class="external-link"><code>arrow</code></a> package,
opening datasets as <a href="https://arrow.apache.org/docs/r/reference/Dataset.html" class="external-link"><code>FileSystemDataset</code>s</a>
</li>
<li>Both <code><a href="../reference/connect_target_timeseries.html">connect_target_timeseries()</a></code> and
<code><a href="../reference/connect_target_oracle_output.html">connect_target_oracle_output()</a></code> work with data stored
locally or in the cloud (e.g., in AWS S3 buckets)</li>
<li>The functions use hub configuration files to determine the
appropriate schema for the target data</li>
<li>Once connected, you can use <code>dplyr</code> verbs to filter and
query the data before collecting it into memory</li>
</ul>
<p>This means the same workflows you use for model output data also
apply to target data.</p>
</div>
<div class="section level2">
<h2 id="accessing-time-series-target-data">Accessing time-series target data<a class="anchor" aria-label="anchor" href="#accessing-time-series-target-data"></a>
</h2>
<p>First, load the required packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hubverse-org.github.io/hubData">hubData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>Use <code><a href="../reference/connect_target_timeseries.html">connect_target_timeseries()</a></code> to open a connection to
time-series target data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hub_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testhubs/v6/target_dir"</span>, package <span class="op">=</span> <span class="st">"hubUtils"</span><span class="op">)</span></span>
<span><span class="va">ts_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_target_timeseries.html">connect_target_timeseries</a></span><span class="op">(</span><span class="va">hub_path</span><span class="op">)</span></span>
<span><span class="va">ts_con</span></span>
<span><span class="co">#&gt; target_timeseries with 2 Parquet files</span></span>
<span><span class="co">#&gt; 4 columns</span></span>
<span><span class="co">#&gt; target_end_date: date32[day]</span></span>
<span><span class="co">#&gt; target: string</span></span>
<span><span class="co">#&gt; location: string</span></span>
<span><span class="co">#&gt; observation: double</span></span></code></pre></div>
<p>This shows the Arrow dataset structure, including the schema (column
names and data types) and information about the underlying file(s). The
connection is lazy - no data is loaded into memory until you explicitly
collect it.</p>
<p>You can query and collect data from the connection using
<code>dplyr</code> verbs:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Collect all time-series data</span></span>
<span><span class="va">ts_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 66 × 4</span></span></span>
<span><span class="co">#&gt;    target_end_date target           location observation</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2022-10-22      wk flu hosp rate 02             0.422</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-10-22      wk flu hosp rate 01             2.78 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-10-22      wk flu hosp rate US             0.716</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-10-29      wk flu hosp rate 02             1.97 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-10-29      wk flu hosp rate 01             5.17 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-10-29      wk flu hosp rate US             1.31 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-11-05      wk flu hosp rate 02             1.41 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-11-05      wk flu hosp rate 01             7.11 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-11-05      wk flu hosp rate US             1.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-11-12      wk flu hosp rate 02             2.81 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 56 more rows</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="filtering-time-series-data">Filtering time-series data<a class="anchor" aria-label="anchor" href="#filtering-time-series-data"></a>
</h3>
<p>You can filter before collecting to work with subsets of the
data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter by location</span></span>
<span><span class="va">ts_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 22 × 4</span></span></span>
<span><span class="co">#&gt;    target_end_date target           location observation</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2022-10-22      wk flu hosp rate US             0.716</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-10-29      wk flu hosp rate US             1.31 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-11-05      wk flu hosp rate US             1.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-11-12      wk flu hosp rate US             2.66 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-11-19      wk flu hosp rate US             3.44 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-11-26      wk flu hosp rate US             5.97 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-12-03      wk flu hosp rate US             7.93 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-12-10      wk flu hosp rate US             7.18 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-12-17      wk flu hosp rate US             6.45 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-12-24      wk flu hosp rate US             5.81 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span></span>
<span><span class="co"># Filter by date range</span></span>
<span><span class="va">ts_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">target_end_date</span> <span class="op">&gt;=</span> <span class="st">"2022-10-01"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 66 × 4</span></span></span>
<span><span class="co">#&gt;    target_end_date target           location observation</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2022-10-22      wk flu hosp rate 02             0.422</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-10-22      wk flu hosp rate 01             2.78 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-10-22      wk flu hosp rate US             0.716</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-10-29      wk flu hosp rate 02             1.97 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-10-29      wk flu hosp rate 01             5.17 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-10-29      wk flu hosp rate US             1.31 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-11-05      wk flu hosp rate 02             1.41 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-11-05      wk flu hosp rate 01             7.11 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-11-05      wk flu hosp rate US             1.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-11-12      wk flu hosp rate 02             2.81 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 56 more rows</span></span></span>
<span></span>
<span><span class="co"># Combine multiple filters</span></span>
<span><span class="va">ts_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">location</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US"</span>, <span class="st">"01"</span><span class="op">)</span>,</span>
<span>    <span class="va">target_end_date</span> <span class="op">&gt;=</span> <span class="st">"2022-10-01"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 44 × 4</span></span></span>
<span><span class="co">#&gt;    target_end_date target           location observation</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2022-10-22      wk flu hosp rate 01             2.78 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-10-22      wk flu hosp rate US             0.716</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-10-29      wk flu hosp rate 01             5.17 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-10-29      wk flu hosp rate US             1.31 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-11-05      wk flu hosp rate 01             7.11 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-11-05      wk flu hosp rate US             1.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-11-12      wk flu hosp rate 01             5.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-11-12      wk flu hosp rate US             2.66 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-11-19      wk flu hosp rate 01             4.46 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-11-19      wk flu hosp rate US             3.44 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 34 more rows</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="accessing-oracle-output-target-data">Accessing oracle-output target data<a class="anchor" aria-label="anchor" href="#accessing-oracle-output-target-data"></a>
</h2>
<p>Use <code><a href="../reference/connect_target_oracle_output.html">connect_target_oracle_output()</a></code> to open a connection
to oracle-output target data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oo_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_target_oracle_output.html">connect_target_oracle_output</a></span><span class="op">(</span><span class="va">hub_path</span><span class="op">)</span></span>
<span><span class="va">oo_con</span></span>
<span><span class="co">#&gt; target_oracle_output with 5 Parquet files</span></span>
<span><span class="co">#&gt; 6 columns</span></span>
<span><span class="co">#&gt; target_end_date: date32[day]</span></span>
<span><span class="co">#&gt; target: string</span></span>
<span><span class="co">#&gt; location: string</span></span>
<span><span class="co">#&gt; output_type: string</span></span>
<span><span class="co">#&gt; output_type_id: string</span></span>
<span><span class="co">#&gt; oracle_value: double</span></span></code></pre></div>
<p>Like the time-series connection, this displays the Arrow dataset
structure with the schema showing columns formatted like model outputs.
Notice the presence of columns like <code>output_type</code>,
<code>output_type_id</code>, and <code>oracle_value</code>.</p>
<p>You can query and collect data from this connection:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Collect all oracle-output data</span></span>
<span><span class="va">oo_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 627 × 6</span></span></span>
<span><span class="co">#&gt;    target_end_date target       location output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2022-10-22      wk flu hosp… US       cdf         1                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-10-22      wk flu hosp… US       cdf         2                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-10-22      wk flu hosp… US       cdf         3                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-10-22      wk flu hosp… US       cdf         4                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-10-22      wk flu hosp… US       cdf         5                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-10-22      wk flu hosp… US       cdf         6                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-10-22      wk flu hosp… US       cdf         7                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-10-22      wk flu hosp… US       cdf         8                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-10-22      wk flu hosp… US       cdf         9                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-10-22      wk flu hosp… US       cdf         10                        1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 617 more rows</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="filtering-oracle-output-data">Filtering oracle-output data<a class="anchor" aria-label="anchor" href="#filtering-oracle-output-data"></a>
</h3>
<p>Oracle-output data has the same structure as model output, making it
easy to filter by output type:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get quantile forecasts only</span></span>
<span><span class="va">oo_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">output_type</span> <span class="op">==</span> <span class="st">"quantile"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 33 × 6</span></span></span>
<span><span class="co">#&gt;    target_end_date target       location output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2022-10-22      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">2</span>380</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-10-22      wk inc flu … 01       quantile    <span style="color: #BB0000;">NA</span>                      141</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-10-22      wk inc flu … 02       quantile    <span style="color: #BB0000;">NA</span>                        3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-10-29      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">4</span>353</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-10-29      wk inc flu … 01       quantile    <span style="color: #BB0000;">NA</span>                      262</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-10-29      wk inc flu … 02       quantile    <span style="color: #BB0000;">NA</span>                       14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-11-05      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">6</span>571</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-11-05      wk inc flu … 01       quantile    <span style="color: #BB0000;">NA</span>                      360</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-11-05      wk inc flu … 02       quantile    <span style="color: #BB0000;">NA</span>                       10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-11-12      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">8</span>848</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 23 more rows</span></span></span></code></pre></div>
<p>Notice that <code>output_type_id</code> is <code>NA</code> for
quantile outputs. This is because the oracle value represents the
observed outcome with all probability mass concentrated on that single
value - the <code>oracle_value</code> applies to all quantile levels.
For <code>pmf</code> or <code>cdf</code> output types,
<code>output_type_id</code> would specify the category or threshold.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get specific pmf category</span></span>
<span><span class="va">oo_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">output_type</span> <span class="op">==</span> <span class="st">"pmf"</span>,</span>
<span>    <span class="va">output_type_id</span> <span class="op">==</span> <span class="st">"large"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 variables: target_end_date &lt;date&gt;, target &lt;chr&gt;, location &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   output_type &lt;chr&gt;, output_type_id &lt;chr&gt;, oracle_value &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="co"># Filter by location and date</span></span>
<span><span class="va">oo_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span>,</span>
<span>    <span class="va">target_end_date</span> <span class="op">==</span> <span class="st">"2022-12-31"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19 × 6</span></span></span>
<span><span class="co">#&gt;    target_end_date target       location output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2022-12-31      wk inc flu … US       mean        <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">19</span>369</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-12-31      wk flu hosp… US       cdf         1                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-12-31      wk flu hosp… US       cdf         2                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-12-31      wk flu hosp… US       cdf         3                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-12-31      wk flu hosp… US       cdf         4                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-12-31      wk flu hosp… US       cdf         5                         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-12-31      wk flu hosp… US       cdf         6                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-12-31      wk flu hosp… US       cdf         7                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-12-31      wk flu hosp… US       cdf         8                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-12-31      wk flu hosp… US       cdf         9                         1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 2022-12-31      wk flu hosp… US       cdf         10                        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 2022-12-31      wk flu hosp… US       cdf         11                        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 2022-12-31      wk flu hosp… US       cdf         12                        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 2022-12-31      wk flu hosp… US       pmf         low                       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 2022-12-31      wk flu hosp… US       pmf         moderate                  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 2022-12-31      wk flu hosp… US       pmf         high                      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 2022-12-31      wk flu hosp… US       pmf         very high                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 2022-12-31      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">19</span>369</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> 2022-12-31      wk inc flu … US       sample      <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">19</span>369</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-target-data">Working with target data<a class="anchor" aria-label="anchor" href="#working-with-target-data"></a>
</h2>
<div class="section level3">
<h3 id="joining-target-data-with-model-outputs">Joining target data with model outputs<a class="anchor" aria-label="anchor" href="#joining-target-data-with-model-outputs"></a>
</h3>
<p>A common workflow is to join oracle-output target data with model
predictions for evaluation. Let’s start by connecting to the model
outputs and collecting predictions:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Connect to model outputs</span></span>
<span><span class="va">hub_con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_hub.html">connect_hub</a></span><span class="op">(</span><span class="va">hub_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collect model outputs for a specific location and output type</span></span>
<span><span class="va">model_data</span> <span class="op">&lt;-</span> <span class="va">hub_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">output_type</span> <span class="op">==</span> <span class="st">"quantile"</span>,</span>
<span>    <span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/collect_hub.html">collect_hub</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 132 × 9</span></span></span>
<span><span class="co">#&gt;    model_id   location reference_date horizon target_end_date target output_type</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 122 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: output_type_id &lt;chr&gt;, value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Next, collect the corresponding oracle-output target data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Collect corresponding oracle-output target data</span></span>
<span><span class="va">target_data</span> <span class="op">&lt;-</span> <span class="va">oo_con</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">output_type</span> <span class="op">==</span> <span class="st">"quantile"</span>,</span>
<span>    <span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">target_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 6</span></span></span>
<span><span class="co">#&gt;    target_end_date target       location output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2022-10-22      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">2</span>380</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-10-29      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">4</span>353</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-11-05      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">6</span>571</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-11-12      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">8</span>848</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-11-19      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">11</span>427</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-11-26      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">19</span>846</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-12-03      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">26</span>333</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-12-10      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">23</span>851</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-12-17      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">21</span>435</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-12-24      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">19</span>286</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 2022-12-31      wk inc flu … US       quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">19</span>369</span></span></code></pre></div>
<p>Before joining, we need to remove the <code>output_type</code> and
<code>output_type_id</code> columns from the oracle-output data. For
quantile (and mean, median, sample) outputs, these columns don’t provide
useful information since the oracle value applies across all quantile
levels. Keeping them would cause merge conflicts.</p>
<p><strong>Note:</strong> For <code>pmf</code> or <code>cdf</code>
output types, you would need to keep these columns as they specify the
category or threshold being predicted.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove unnecessary columns that would cause merge conflicts</span></span>
<span><span class="va">target_data</span> <span class="op">&lt;-</span> <span class="va">target_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">output_type</span>, <span class="va">output_type_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join on common task ID columns</span></span>
<span><span class="va">join_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"target_end_date"</span>, <span class="st">"target"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="va">model_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">target_data</span>,</span>
<span>    by <span class="op">=</span> <span class="va">join_cols</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">comparison</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 132 × 10</span></span></span>
<span><span class="co">#&gt;    model_id   location reference_date horizon target_end_date target output_type</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Flusight-… US       2022-10-22           1 2022-10-29      wk in… quantile   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 122 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: output_type_id &lt;chr&gt;, value &lt;dbl&gt;, oracle_value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Now we have successfully aligned predicted values
(<code>value</code>) with target observations
(<code>oracle_value</code>) for each combination of task IDs.</p>
<div class="section level4">
<h4 id="special-case-hubs-with-horizon-based-forecasts">Special case: Hubs with horizon-based forecasts<a class="anchor" aria-label="anchor" href="#special-case-hubs-with-horizon-based-forecasts"></a>
</h4>
<p>Some hubs collect forecasts using only a reference date (or origin
date) and a horizon column, rather than explicitly storing the target
end date. In these cases, the target end date is often calculated as
<code>origin_date + (horizon * 7L)</code> (assuming weekly
forecasts).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model data without target_end_date</span></span>
<span><span class="va">model_data_horizon</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 132 × 8</span></span></span>
<span><span class="co">#&gt;    model_id    location reference_date horizon target output_type output_type_id</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.025         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.1           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.2           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.3           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.4           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.5           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.6           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.7           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.8           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.9           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 122 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>When working with such hubs, you’ll need to calculate the
<code>target_end_date</code> in the model output data before joining
with target data:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate target_end_date from origin_date and horizon</span></span>
<span><span class="va">model_data_horizon</span> <span class="op">&lt;-</span> <span class="va">model_data_horizon</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    target_end_date <span class="op">=</span> <span class="va">reference_date</span> <span class="op">+</span> <span class="op">(</span><span class="va">horizon</span> <span class="op">*</span> <span class="fl">7L</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">model_data_horizon</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 132 × 9</span></span></span>
<span><span class="co">#&gt;    model_id    location reference_date horizon target output_type output_type_id</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.025         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.1           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.2           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.3           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.4           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.5           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.6           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.7           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.8           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.9           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 122 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: value &lt;dbl&gt;, target_end_date &lt;date&gt;</span></span></span></code></pre></div>
<p>Now we can join with target data as before:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">join_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"target_end_date"</span>, <span class="st">"target"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_horizon</span> <span class="op">&lt;-</span> <span class="va">model_data_horizon</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="va">target_data</span>,</span>
<span>    by <span class="op">=</span> <span class="va">join_cols</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_horizon</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 132 × 10</span></span></span>
<span><span class="co">#&gt;    model_id    location reference_date horizon target output_type output_type_id</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.025         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.1           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.2           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.3           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.4           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.5           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.6           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.7           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.8           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Flusight-b… US       2022-10-22           1 wk in… quantile    0.9           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 122 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: value &lt;dbl&gt;, target_end_date &lt;date&gt;, oracle_value &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Note: The multiplier (7L) assumes weekly horizons. Adjust this based
on your hub’s configuration (e.g., 1L for daily horizons).</p>
</div>
</div>
<div class="section level3">
<h3 id="computing-simple-metrics">Computing simple metrics<a class="anchor" aria-label="anchor" href="#computing-simple-metrics"></a>
</h3>
<p>Once you have both model predictions and target data, you can compute
evaluation metrics:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate absolute error for median forecasts</span></span>
<span><span class="va">comparison</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">output_type_id</span> <span class="op">==</span> <span class="st">"0.5"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    abs_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">value</span> <span class="op">-</span> <span class="va">oracle_value</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">model_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    mean_abs_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">abs_error</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   model_id          mean_abs_error</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Flusight-baseline          <span style="text-decoration: underline;">9</span>050.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> MOBS-GLEAM_FLUH            <span style="text-decoration: underline;">5</span>475.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PSI-DICE                   <span style="text-decoration: underline;">6</span>526.</span></span></code></pre></div>
<p>This workflow of aligning predictions with target observations and
computing metrics is exactly what evaluation tools like hubEvals
automate as part of comprehensive model evaluation pipelines.</p>
</div>
</div>
<div class="section level2">
<h2 id="accessing-target-data-from-cloud-hubs">Accessing target data from cloud hubs<a class="anchor" aria-label="anchor" href="#accessing-target-data-from-cloud-hubs"></a>
</h2>
<p>Both <code><a href="../reference/connect_target_timeseries.html">connect_target_timeseries()</a></code> and
<code><a href="../reference/connect_target_oracle_output.html">connect_target_oracle_output()</a></code> work seamlessly with
cloud-based hubs. Use the same cloud connection approach as with
<code><a href="../reference/connect_hub.html">connect_hub()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Connect to a cloud hub</span></span>
<span><span class="va">s3_hub_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/s3_bucket.html">s3_bucket</a></span><span class="op">(</span><span class="st">"example-complex-forecast-hub"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access time-series target data from cloud</span></span>
<span><span class="va">ts_cloud</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_target_timeseries.html">connect_target_timeseries</a></span><span class="op">(</span><span class="va">s3_hub_path</span><span class="op">)</span></span>
<span><span class="va">ts_cloud</span></span>
<span><span class="co">#&gt; target_timeseries with 1 csv file</span></span>
<span><span class="co">#&gt; 4 columns</span></span>
<span><span class="co">#&gt; target_end_date: date32[day]</span></span>
<span><span class="co">#&gt; target: string</span></span>
<span><span class="co">#&gt; location: string</span></span>
<span><span class="co">#&gt; observation: double</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Collect a sample of the data</span></span>
<span><span class="va">ts_cloud</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 402 × 4</span></span></span>
<span><span class="co">#&gt;    target_end_date target          location observation</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2020-01-11      wk inc flu hosp US                 1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2020-01-18      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2020-01-25      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2020-02-01      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2020-02-08      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2020-02-15      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2020-02-22      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2020-02-29      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2020-03-07      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2020-03-14      wk inc flu hosp US                 0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 392 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Access oracle-output target data from cloud</span></span>
<span><span class="va">oo_cloud</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_target_oracle_output.html">connect_target_oracle_output</a></span><span class="op">(</span><span class="va">s3_hub_path</span><span class="op">)</span></span>
<span><span class="va">oo_cloud</span></span>
<span><span class="co">#&gt; target_oracle_output with 1 csv file</span></span>
<span><span class="co">#&gt; 6 columns</span></span>
<span><span class="co">#&gt; location: string</span></span>
<span><span class="co">#&gt; target_end_date: date32[day]</span></span>
<span><span class="co">#&gt; target: string</span></span>
<span><span class="co">#&gt; output_type: string</span></span>
<span><span class="co">#&gt; output_type_id: string</span></span>
<span><span class="co">#&gt; oracle_value: double</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Collect a sample of oracle-output data</span></span>
<span><span class="va">oo_cloud</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,780 × 6</span></span></span>
<span><span class="co">#&gt;    location target_end_date target       output_type output_type_id oracle_value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> US       2022-10-22      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">2</span>380</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> US       2022-10-29      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">4</span>353</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> US       2022-11-05      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">6</span>571</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> US       2022-11-12      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                     <span style="text-decoration: underline;">8</span>848</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> US       2022-11-19      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">11</span>427</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> US       2022-11-26      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">19</span>846</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> US       2022-12-03      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">26</span>333</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> US       2022-12-10      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">23</span>851</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> US       2022-12-17      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">21</span>435</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> US       2022-12-24      wk inc flu … quantile    <span style="color: #BB0000;">NA</span>                    <span style="text-decoration: underline;">19</span>286</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,770 more rows</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="performance-tips-for-cloud-hubs">Performance tips for cloud hubs<a class="anchor" aria-label="anchor" href="#performance-tips-for-cloud-hubs"></a>
</h3>
<p>When working with cloud-based target data, consider these performance
tips:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Filter before collecting</strong>: Always apply filters on
the Arrow dataset before calling <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> to minimize data
transfer:</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Good: filter first, then collect</span></span>
<span><span class="va">ts_cloud</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Less efficient: collect everything, then filter</span></span>
<span><span class="va">ts_cloud</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<strong>Select specific columns</strong>: If you only need certain
columns, use <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> before collecting:</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_cloud</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">location</span>, <span class="va">target_end_date</span>, <span class="va">observation</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"US"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 402 × 3</span></span></span>
<span><span class="co">#&gt;    location target_end_date observation</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> US       2020-01-11                1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> US       2020-01-18                0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> US       2020-01-25                0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> US       2020-02-01                0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> US       2020-02-08                0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> US       2020-02-15                0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> US       2020-02-22                0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> US       2020-02-29                0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> US       2020-03-07                0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> US       2020-03-14                0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 392 more rows</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="hub-version-compatibility">Hub version compatibility<a class="anchor" aria-label="anchor" href="#hub-version-compatibility"></a>
</h2>
<p>The target data functions work transparently across different hub
versions:</p>
<ul>
<li>
<strong>Newer hubs (v6+)</strong> with <code>target-data.json</code>
configuration benefit from optimized schema creation and potentially
better performance</li>
<li>
<strong>Older hubs</strong> without <code>target-data.json</code>
have their schemas inferred automatically from data files</li>
</ul>
<p>As a user, you don’t need to worry about these implementation details
- the same API works for all hubs, and the functions automatically
detect and use the appropriate method.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<ul>
<li>Use <code><a href="../reference/connect_target_timeseries.html">connect_target_timeseries()</a></code> for historical
observational data</li>
<li>Use <code><a href="../reference/connect_target_oracle_output.html">connect_target_oracle_output()</a></code> for model-formatted
target data</li>
<li>Both functions return Arrow datasets that work with
<code>dplyr</code> verbs</li>
<li>Filter before collecting to improve performance, especially for
cloud hubs</li>
<li>Oracle-output format makes it easy to join with model predictions
for evaluation</li>
<li>The same API works across all hub versions</li>
</ul>
<p>For more information on: - Model output data, see
<code>vignette("connect_hub")</code> - Target data concepts, see the <a href="https://docs.hubverse.io/en/latest/user-guide/target-data.html" class="external-link">Hubverse
target data guide</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anna Krystalli.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0. PR Previews built by <a href="https://www.netlify.com" class="external-link">Netlify</a>. Provided without <strong>any warranty</strong>.</p>
</div>

    </footer>
</div>





  </body>
</html>
